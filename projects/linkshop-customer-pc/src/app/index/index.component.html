  <div class="main">
    <div class="side-left">
      <div class="content">
        <div class="passager-flow panel">
          <span class="left-top"></span>
          <span class="right-top"></span>
          <span class="right-bottom"></span>
          <span class="left-bottom"></span>
          <p class="content-title">客流量</p>
          <ul class="data-panel">
            <li>
              <span>{{index.date.curr.name}}</span>
              <span>{{dataByDate?.count}}</span>
            </li>
            <li>
              <span>当前驻留</span>
              <span>0</span>
            </li>
            <li><span>累计人数</span>
              <span>{{dataSum?.count / 100000 > 1 ? (dataSum?.count / 10000 | number: '1.0-1') + 'w' : dataSum?.count}}</span>
            </li>
          </ul>
        </div>
        <div class="gender-radio">
          <span class="left-top"></span>
          <span class="right-top"></span>
          <span class="right-bottom"></span>
          <span class="left-bottom"></span>
          <p class="content-title">性别比例</p>
          <ul class="data-panel">
            <li>
              <span>{{index.date.curr.name}}比例(男:女)</span>
              <span>
                {{ageAndGender?.sumCount === 0 ? 0 : ageAndGender?.mCount * 100 / ageAndGender?.sumCount | number: '1.0-0'}}
                :
                {{ageAndGender?.sumCount === 0 ? 0 : ((100 - ageAndGender?.mCount * 100 / ageAndGender?.sumCount)| number: '1.0-0')}}
              </span>
            </li>
            <li><span>累计比例(男:女)</span>
              <span>
                {{ageAndGenderSum?.sumCount === 0 ? 0 : ageAndGenderSum?.mCount * 100 / ageAndGenderSum?.sumCount | number: '1.0-0'}}
                :
                {{ageAndGenderSum?.sumCount === 0 ? 0 : ((100 - ageAndGenderSum?.mCount * 100 / ageAndGenderSum?.sumCount)| number: '1.0-0')}}
              </span>
            </li>
          </ul>
        </div>
        <div class="average-age">
          <span class="left-top"></span>
          <span class="right-top"></span>
          <span class="right-bottom"></span>
          <span class="left-bottom"></span>
          <p class="content-title">性别比例</p>
          <ul class="data-panel">
            <li>
              <span>{{index.date.curr.name}}平均年龄</span>
              <span>{{ageAndGender?.avgAge| number: '1.0-1'}}</span>
            </li>
            <li><span>累计平均年龄</span>
              <span>{{ageAndGenderSum?.avgAge| number: '1.0-1'}}</span>
            </li>
          </ul>
        </div>
        <div class="age-gender-radio">
          <span class="left-top"></span>
          <span class="right-top"></span>
          <span class="right-bottom"></span>
          <span class="left-bottom"></span>
          <p class="content-title">性别比例</p>
          <ul class="data-panel">
            <li>
              <span class="list-style">{{index.date.curr.name}}比例TOP3</span>
              <span *ngFor="let item of ageAndGender?.topList">{{item.gender === 'M' ? '男' : '女'}} {{item.age_range}}岁 {{item.count * 100 / ageAndGender?.sumCount | number: '1.0-0'}}%</span>
              <span>CR3 {{ageAndGender?.crCount * 100 / ageAndGender?.sumCount| number: '1.0-0'}}%</span>
            </li>
            <li>
              <span class="list-style">累计比例TOP3</span>
              <span *ngFor="let item of ageAndGenderSum?.topList">{{item.gender === 'M' ? '男' : '女'}} {{item.age_range}}岁 {{item.count * 100 / ageAndGenderSum?.sumCount | number: '1.0-0'}}%</span>
              <span>CR3 {{ageAndGenderSum?.crCount * 100 / ageAndGenderSum?.sumCount| number: '1.0-0'}}%</span>
            </li>
          </ul>
        </div>

      </div>
    </div>
    <div class="side-right">
      <div class="flow-time">
        <span class="left-top"></span>
        <span class="right-top"></span>
        <span class="right-bottom"></span>
        <span class="left-bottom"></span>
        <p class="content-title">驻留时间</p>
        <ul class="data-panel">
          <li>
            <span>{{index.date.curr.name}}平均驻留(分钟)</span>
            <span>{{dataByDate?.avgStay| number: '1.0-1'}}</span>
          </li>
          <li><span>累计平均驻留(分钟)</span>
            <span>{{dataSum?.avgStay| number: '1.0-1'}}</span>
          </li>
        </ul>
      </div>
      <div class="collect-power">
        <span class="left-top"></span>
        <span class="right-top"></span>
        <span class="right-bottom"></span>
        <span class="left-bottom"></span>
        <p class="content-title">集客力</p>
        <ul class="data-panel">
          <li>
            <span>{{index.date.curr.name}}(人/m²)</span>
            <span>{{dataByDate?.jkl| number: '1.0-1'}}</span>
          </li>
          <li><span>累计(人/m²)</span>
            <span>{{dataSum?.jkl| number: '1.0-1'}}</span>
          </li>
        </ul>
      </div>
      <div class="ping">
        <span class="left-top"></span>
        <span class="right-top"></span>
        <span class="right-bottom"></span>
        <span class="left-bottom"></span>
        <p class="content-title">坪效 </p>
        <ul class="data-panel">
          <li>
            <span>{{index.date.curr.name}}(元/m²)</span>
            <span>{{dataByDate?.px| number: '1.0-1'}}</span>
          </li>
          <li><span>累计(元/m²)</span>
            <span>{{dataSum?.px| number: '1.0-1'}}</span>
          </li>
        </ul>
      </div>
      <div class="sales">
        <span class="left-top"></span>
        <span class="right-top"></span>
        <span class="right-bottom"></span>
        <span class="left-bottom"></span>
        <p class="content-title">销售情况 </p>
        <ul class="data-panel">
          <li>
            <span>销售量(件)</span>
            <span>{{dataSum?.volume}}</span>
          </li>
          <li><span>销售额(元)</span>
            <span>{{dataSum?.amount / 100000 > 1 ? (dataSum?.amount / 10000 | number: '1.0-1') + 'W' : dataSum?.amount}}</span>
          </li>
        </ul>
      </div>
    </div>
    <div class="map-area">
      <div class="btns">
        <ul class="button">
          <li>{{index.des.curr.name}}</li>
          <li>
            <span class="up" (click)="switchDesType(-1)"></span>
            <span class="down" (click)="switchDesType(1)"></span>
          </li>
        </ul>
        <ul class="button">
          <li>{{index.date.curr.name}}</li>
          <li>
            <span class="up" (click)="switchDateType(-1)"></span>
            <span class="down" (click)="switchDateType(1)"></span>
          </li>
        </ul>
      </div>
      <div *ngIf="backButtonStatus" class="back-btn" (click)="goBack()">返回</div>
      <ngx-amap style="width: 100%;" class="map" #map
                (ready)="onMapReady($event)"
                [mapStyle]="'amap://styles/4c1e1d59e0f2fc4c398fe0841567f1b1'"
                [center]="org.geo" [zoom]="5">

        <ng-container *ngFor="let item of bubbleList$ | async">
          <amap-marker [position]="item.geo" [zIndex]="101" [offset]="{x: -20, y: -44}"
                       (markerClick)="onMarkerClick($event)" [extData]="item"
                       [content]="'<div class=\'bubble_map\'>' + item[index.des.curr.val] + '</div>'">
          </amap-marker>

          <amap-marker [position]="item.geo" [offset]="{x: -6 * item.name.length, y: 0}"
                       (ready)="onMarkerReady(map)"
                       [content]="'<div style=\'font-size: 14px; color: #fff;width: ' + (item.name.length + 1) * 14 + 'px;\'>' + item.name + '</div>'">
          </amap-marker>
        </ng-container>

      </ngx-amap>



    </div>
  </div>


